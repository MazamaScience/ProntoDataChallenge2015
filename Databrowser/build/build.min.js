// Main js file. JS code follows many of the guidelines specified at https://github.com/johnpapa/angular-styleguide
// Exposes the model to the template
// Contains plot options, map, and overlay options
// Creates a full page popup that fades out when clicked
// Relies on CSS rules from Mazama_databrowser_base.css
// There should be no need to make changes to this
// Relies on CSS rules from Mazama_databrowser_base.css
// There should be no need to make changes to this
// this data.
// Service for making JSON requests. Also provides access to the request status, i.e. 
// loading or error messages
(function(){"use strict";function e(e,t){e.state("index",{url:"/",templateUrl:"views/main.html"}).state("about",{url:"/about",templateUrl:"views/about.html"}),t.otherwise("/")}angular.module("App",["ui.router","ngMaps","ui.slider","ui.bootstrap"]).config(e),e.$inject=["$stateProvider","$urlRouterProvider"]})(),function(){"use strict";function e(e,t,a){function l(){a.get(t.request).then(function(e){var t=e.data.return_json;t=JSON.parse(t).returnValues,n.returnData.plotTypes=n.request.plotTypes.split(","),n.returnData.relBase=e.data.rel_base})}function r(e,t){var a=e+"_"+t;n.popup.relBase=e,n.popup.plotType=t,n.popup.visible=!0,n.popup.url=a}function u(){switch(n.returnData.plotTypes.length){case 1:case 2:return"col-md-6";case 3:case 5:case 6:return"col-md-4";case 4:case 7:case 8:return"col-md-3";default:return"col-md-6"}}var n=this;n.request=t.request,n.returnData={},n.forms=t.forms,n.map=t.map(e),n.map.events=n.map.events,n.marker=t.marker,n.updatePlot=l,n.status=a.status,n.popup={visible:!1,url:null},n.clicked=r,n.plotTableClass=u,l(),document.onkeydown=function(t){if(t=t||window.event,console.log(n.popup),n.popup.visible){var a=n.returnData.plotTypes.indexOf(n.popup.plotType);switch(t.which||t.keyCode){case 37:a=0>a-1?n.returnData.plotTypes.length-1:a-1;break;case 39:a=a+1>n.returnData.plotTypes.length-1?0:a+1}console.log(a),n.popup.plotType=n.returnData.plotTypes[a],n.popup.url=n.popup.relBase+"_"+n.popup.plotType,e.$apply()}}}angular.module("App").controller("Main",e),e.$inject=["$scope","LocalData","RequestService","$location"]}(),angular.module("App").directive("selectMenu",["$compile",function(e){return{restrict:"E",transclude:!0,scope:{model:"=",options:"="},template:'<div class="btn-group" dropdown><button type="button" class="btn btn-default btn-block" dropdown-toggle>{{getText(model)}} <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="opt in options" ng-click="click(opt)"><a>{{opt.text}}</a></li></ul></div>',link:function(t,a){var l=t.options;t.getText=function(e){for(var t=0;l.length>t;t++)if(l[t].value===e)return l[t].text;return""},t.click=function(e){t.model=e.value},e(a.html())(t)}}}]),angular.module("App").directive("popup",function(){return{restrict:"E",transclude:!0,scope:{visible:"="},template:'<div class="popup-wrapper" ng-click="visible=false" ng-class="{visible: visible}"><div class="row popup" ng-transclude></div></div>'}}),function(){"use strict";function e(){var e={language:"en",plotWidth:1024,productType:"systemTable",plotTypes:"pie_user",userType:"all",age:"all",gender:"all",dayType:"all",timeOfDay:"all",distance:"all",stationId:"all",lat:47,lng:122},t={plotGroups:[{text:"Members vs. Visitors",value:"pie_user"},{text:"Time of Day",value:"heatmap_weekByHour,pie_daylight"},{text:"Calendar Views",value:"heatmap_weekByHour,calendar_weather"},{text:"Station Analysis",value:"bubble_station"},{text:"Everything",value:"pie_user,barplot_weekByDay,heatmap_weekByHour,pie_daylight,calendar_weather,bubble_station"}],userType:[{text:"All Users",value:"all"},{text:"Annual",value:"annual"},{text:"Short-Term",value:"shortTerm"}],age:[{text:"All Ages",value:"all"},{text:"Under 21",value:"_21"},{text:"21 to 30",value:"21_30"},{text:"31 to 40",value:"31_40"},{text:"41 to 60",value:"41_60"},{text:"Over 60",value:"61_"}],gender:[{text:"All Genders",value:"all"},{text:"Male",value:"male"},{text:"Female",value:"female"},{text:"Other",value:"other"}],dayType:[{text:"All Days",value:"all"},{text:"Weekday",value:"weekday"},{text:"Weekend",value:"weekend"}],timeOfDay:[{text:"All Times",value:"all"},{text:"Early 4-6",value:"early"},{text:"AM Commute 7-9",value:"amCommute"},{text:"Mid Day 10-3",value:"midday"},{text:"PM Commute 4-6",value:"pmCommute"},{text:"Evening 7-10",value:"evening"},{text:"Night 11-3",value:"night"}],distance:[{text:"All Distances",value:"all"},{text:"Zero",value:"zero"},{text:"0-1 km",value:"0_1"},{text:"1-2 km",value:"1_2"},{text:"2-3 km",value:"2_3"},{text:"3-5 km",value:"3_5"},{text:" >5 km",value:"5_"}],stationId:[{text:"All Stations",value:"all"},{text:"Pier 69",value:"WF-01"}]},a=function(e){return{center:[47,-122],zoom:4,events:{click:function(t){r.request.lat=Math.round(Math.pow(10,4)*t.latLng.lat())/Math.pow(10,4),r.request.lng=Math.round(Math.pow(10,4)*t.latLng.lng())/Math.pow(10,4),e.$apply()}}}},l={options:function(){return{draggable:!0}},decimals:4},r={request:e,forms:t,map:a,marker:l};return r}angular.module("App").factory("LocalData",e),e.$inject=[]}(),function(){"use strict";function e(e,t){function a(){return p}function l(e){var t="";for(var a in e)""!==t&&(t+="&"),t+=a+"="+e[a];return t}function r(e){return t.reject(e.data.message)}function u(e){return p.loading=!1,"ERROR"===e.data.status?(p.error=e.data.error_text,t.reject(e.data.error_text)):e}function n(t){p.loading=!0,p.error=!1;var a=e({method:"POST",url:o+l(t)});return a.then(u,r)}var o="/cgi-bin/__DATABROWSER__.cgi?",p={loading:!1,error:!1},s={status:a,get:n};return s}angular.module("App").factory("RequestService",e),e.$inject=["$http","$q"]}();