// Main js file. JS code follows many of the guidelines specified at https://github.com/johnpapa/angular-styleguide
// Exposes the model to the template
// Contains plot options, map, and overlay options
// Creates a full page popup that fades out when clicked
// Relies on CSS rules from Mazama_databrowser_base.css
// There should be no need to make changes to this
// Relies on CSS rules from Mazama_databrowser_base.css
// There should be no need to make changes to this
// this data.
// Service for making JSON requests. Also provides access to the request status, i.e. 
// loading or error messages
(function(){"use strict";function e(e,t){e.state("index",{url:"/",templateUrl:"views/main.html"}).state("about",{url:"/about",templateUrl:"views/about.html"}),t.otherwise("/")}angular.module("App",["ui.router","ngMaps","ui.slider","ui.bootstrap"]).config(e),e.$inject=["$stateProvider","$urlRouterProvider"]})(),function(){"use strict";function e(e,t,a){function r(){a.get(t.request).then(function(e){var t=e.data.return_json;t=JSON.parse(t).returnValues,u.returnData.plotTypes=u.request.plotTypes.split(","),u.returnData.relBase=e.data.rel_base})}function l(e,t){var a=e+"_"+t;u.popup.relBase=e,u.popup.plotType=t,u.popup.visible=!0,u.popup.url=a}function o(){switch(u.returnData.plotTypes.length){case 1:case 2:return"col-md-6";case 3:case 5:case 6:case 9:return"col-md-4";case 4:case 7:case 8:case 10:case 11:case 12:return"col-md-3";default:return"col-md-6"}}var u=this;u.request=t.request,u.returnData={},u.forms=t.forms,u.map=t.map(e),u.map.events=u.map.events,u.marker=t.marker,u.updatePlot=r,u.status=a.status,u.popup={visible:!1,url:null},u.clicked=l,u.plotTableClass=o,r(),document.onkeydown=function(t){if(t=t||window.event,console.log(u.popup),u.popup.visible){var a=u.returnData.plotTypes.indexOf(u.popup.plotType);switch(t.which||t.keyCode){case 37:a=0>a-1?u.returnData.plotTypes.length-1:a-1;break;case 39:a=a+1>u.returnData.plotTypes.length-1?0:a+1}console.log(a),u.popup.plotType=u.returnData.plotTypes[a],u.popup.url=u.popup.relBase+"_"+u.popup.plotType,e.$apply()}}}angular.module("App").controller("Main",e),e.$inject=["$scope","LocalData","RequestService","$location"]}(),angular.module("App").directive("selectMenu",["$compile",function(e){return{restrict:"E",transclude:!0,scope:{model:"=",options:"="},template:'<div class="btn-group" dropdown><button type="button" class="btn btn-default btn-block" dropdown-toggle>{{getText(model)}} <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="opt in options" ng-click="click(opt)"><a>{{opt.text}}</a></li></ul></div>',link:function(t,a){var r=t.options;t.getText=function(e){for(var t=0;r.length>t;t++)if(r[t].value===e)return r[t].text;return""},t.click=function(e){t.model=e.value},e(a.html())(t)}}}]),angular.module("App").directive("popup",function(){return{restrict:"E",transclude:!0,scope:{visible:"="},template:'<div class="popup-wrapper" ng-click="visible=false" ng-class="{visible: visible}"><div class="row popup" ng-transclude></div></div>'}}),function(){"use strict";function e(){var e={language:"en",plotWidth:1024,productType:"systemTable",plotGroups:"pie_user,barplot_hourByUser,barplot_monthByUser",plotTypes:"pie_user,barplot_hourByUser,barplot_monthByUser",userType:"all",age:"all",gender:"all",dayType:"all",timeOfDay:"all",distance:"all",stationId:"all",lat:47,lng:122},t={plotGroups:[{text:"System Overview",value:"pie_user,barplot_hourByUser,barplot_monthByUser"},{text:"Departure/Arrival Maps",value:"bubble_stationFrom,bubble_stationTo"},{text:"Station Usage",value:"bubble_stationTotal,barplot_station"},{text:"Calendar",value:"heatmap_weekByHour,calendar_weather"},{text:"Time of Day",value:"heatmap_weekByHour,pie_daylight"},{text:"Single Station Focus",value:"bubble_stationTotal,heatmap_weekByHour,barplot_station,barplot_hourByUser"},{text:"Chart Junkie",value:"pie_user,barplot_hourByUser,barplot_monthByUser,pie_daylight,bubble_stationFrom,bubble_stationTo,bubble_stationTotal,barplot_station,heatmap_weekByHour,calendar_weather"},{text:"... experimental ...",value:"pie_user"}],userType:[{text:"All Users",value:"all"},{text:"Annual",value:"annual"},{text:"Short-Term",value:"shortTerm"}],age:[{text:"All Ages",value:"all"},{text:"Under 21",value:"_21"},{text:"21 to 30",value:"21_30"},{text:"31 to 40",value:"31_40"},{text:"41 to 60",value:"41_60"},{text:"Over 60",value:"61_"}],gender:[{text:"All Genders",value:"all"},{text:"Male",value:"male"},{text:"Female",value:"female"},{text:"Other",value:"other"}],dayType:[{text:"All Days",value:"all"},{text:"Weekday",value:"weekday"},{text:"Weekend",value:"weekend"},{text:"October - March",value:"Oct_Mar"},{text:"April - September",value:"Apr_Sep"},{text:"> 0.5 in Rain",value:"rain_05"},{text:"< 50 F",value:"temp__50"},{text:"> 50 F",value:"temp_50"},{text:"APA Conference: Apr 18-21",value:"APA_conference"}],timeOfDay:[{text:"All Times",value:"all"},{text:"Early 4-6",value:"early"},{text:"AM Commute 7-9",value:"amCommute"},{text:"Mid Day 10-3",value:"midday"},{text:"PM Commute 4-6",value:"pmCommute"},{text:"Evening 7-10",value:"evening"},{text:"Night 11-3",value:"night"}],distance:[{text:"All Distances",value:"all"},{text:"Zero",value:"zero"},{text:"0-1 km",value:"0_1"},{text:"1-2 km",value:"1_2"},{text:"2-3 km",value:"2_3"},{text:"3-5 km",value:"3_5"},{text:" >5 km",value:"5_"}],stationId:[{text:"from Any Station",value:"all"},{text:"from 1st Ave & Marion St",value:"CBD-05"},{text:"from 2nd Ave & Blanchard St",value:"BT-05"},{text:"from 2nd Ave & Pine St",value:"CBD-13"},{text:"from 2nd Ave & Vine St",value:"BT-03"},{text:"from 2nd Ave & Spring St",value:"CBD-06"},{text:"from 3rd Ave & Broad St",value:"BT-01"},{text:"from 6th Ave & Blanchard St",value:"BT-04"},{text:"from 6th Ave S & S King St",value:"ID-04"},{text:"from 7th Ave & Union St",value:"CBD-03"},{text:"from 9th Ave N & Mercer St",value:"DPD-01"},{text:"from 12th Ave & E Denny Way",value:"CH-06"},{text:"from 12th Ave & E Mercer St",value:"CH-15"},{text:"from 12th Ave & NE Campus Pkwy",value:"UD-04"},{text:"from 12th Ave & E Yesler Way",value:"CD-01"},{text:"from 15th Ave NE & NE 40th St",value:"UW-04"},{text:"from 15th Ave E & E Thomas St",value:"CH-05"},{text:"from Bellevue Ave & E Pine St",value:"CH-12"},{text:"from Burke Museum",value:"UW-02"},{text:"from Burke-Gilman Trail",value:"UD-01"},{text:"from Cal Anderson Park",value:"CH-08"},{text:"from Children's Hospital",value:"DPD-03"},{text:"from City Hall",value:"CBD-07"},{text:"from Dexter Ave & Denny Way",value:"SLU-18"},{text:"from Dexter Ave N & Aloha St",value:"SLU-02"},{text:"from E Blaine St & Fairview Ave E",value:"EL-03"},{text:"from E Harrison St & Broadway Ave E",value:"CH-02"},{text:"from E Pine St & 16th Ave",value:"CH-07"},{text:"from Eastlake Ave E & E Allison St",value:"EL-05"},{text:"from Fred Hutchinson Cancer Research Center",value:"EL-01"},{text:"from Frye Art Museum",value:"FH-01"},{text:"from Harvard Ave & E Pine St",value:"CH-09"},{text:"from Key Arena",value:"SLU-19"},{text:"from King Street Station Plaza",value:"PS-05"},{text:"from Mercer St & 9th Ave N",value:"SLU-21"},{text:"from NE 42nd St & University Way NE",value:"UD-02"},{text:"from NE 47th St & 12th Ave NE",value:"UD-07"},{text:"from Occidental Park",value:"PS-04"},{text:"from PATH",value:"SLU-07"},{text:"from Pier 69",value:"WF-01"},{text:"from Pine St & 9th Ave",value:"SLU-16"},{text:"from Pronto shop",value:"XXX-01"},{text:"from REI",value:"SLU-01"},{text:"from Republican St & Westlake Ave N",value:"SLU-04"},{text:"from Seattle Aquarium",value:"WF-04"},{text:"from Seattle University",value:"FH-04"},{text:"from Lake Union Park",value:"SLU-17"},{text:"from Summit Ave & E Denny Way",value:"CH-01"},{text:"from Summit Ave E & E Republican St",value:"CH-03"},{text:"from Terry Ave & Stewart St",value:"SLU-20"},{text:"from Union St & 4th Ave",value:"CBD-04"},{text:"from UW Engineering Library",value:"UW-06"},{text:"from UW Magnuson Health Sciences Center Rotunda",value:"UW-10"},{text:"from UW McCarty Hall",value:"UW-01"},{text:"from UW Intramural Activities Building",value:"UW-07"},{text:"from Westlake Ave & 6th Ave",value:"SLU-15"}]},a=function(e){return{center:[47,-122],zoom:4,events:{click:function(t){l.request.lat=Math.round(Math.pow(10,4)*t.latLng.lat())/Math.pow(10,4),l.request.lng=Math.round(Math.pow(10,4)*t.latLng.lng())/Math.pow(10,4),e.$apply()}}}},r={options:function(){return{draggable:!0}},decimals:4},l={request:e,forms:t,map:a,marker:r};return l}angular.module("App").factory("LocalData",e),e.$inject=[]}(),function(){"use strict";function e(e,t){function a(){return i}function r(e){var t="";for(var a in e)""!==t&&(t+="&"),t+=a+"="+e[a];return t}function l(e){return t.reject(e.data.message)}function o(e){return i.loading=!1,"ERROR"===e.data.status?(i.error=e.data.error_text,t.reject(e.data.error_text)):e}function u(t){i.loading=!0,i.error=!1;var a=e({method:"POST",url:n+r(t)});return a.then(o,l)}var n="/cgi-bin/__DATABROWSER__.cgi?",i={loading:!1,error:!1},s={status:a,get:u};return s}angular.module("App").factory("RequestService",e),e.$inject=["$http","$q"]}();